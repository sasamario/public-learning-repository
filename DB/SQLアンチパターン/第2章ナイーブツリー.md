/# 第2章ナイーブツリー（素朴な木） p13〜31
結論： TODO:全て読み終わったら記載

また以下サイトが図の説明もあり、とてもわかりやすかった！！
- [MySQLで階層構造を扱うための再帰的なクエリの実装方法と実用例](https://zenn.dev/rescuenow/articles/c7d7291f2deed8)

## アンチパターン発生の背景
階層型のデータ（例：スレッド形式の掲示板）で、親にのみ依存する構造としている  
※ただし、階層の深さであったり使用するDBによっては上記構造でも問題ない場合もある


## アンチパターンによる影響
以下の場合に難しくなったり、複雑化する
- 子孫データなど遠い関係を持つデータの取得
- データのメンテナンス（削除）
	- →ノードを削除すると子孫ノードから順に削除する必要が出てくる（整合性制約）

## 解決策
代替ツリーモデルの使用。  
代替ツリーモデルには以下の3つがある。

- 経路列挙モデル
- 入れ子集合モデル
- 閉包テーブルモデル

### 経路列挙モデル
親データから自身までのパス（経路）を情報として持つ方法。  
イメージとしてはファイルシステム /var/www/html みたいな

| ID | パス | コメント |
| ---- | ---- | ---- |
| 1 | 1/ | コメント1 |
| 2 | 1/2/ | コメント1に対するリプライ1 |
| 3 | 1/3/ | コメント1に対するリプライ2 |
| 4 | 1/2/4/ | コメント2に対するリプライ |

■メリット  
- 追加は、追加したい親のパス+自身のIDをつければできる
- 検索は、パターンマッチを行うことで容易

■デメリット  
- 経路を文字列として持つため、第一章で触れたジェイウォークのような欠点がある
	- インデックスが効かない
	- 外部キー設定ができない
	- パス文字列のメンテナンスはアプリケーション側に依存する（値のチェック等）
	- 文字列長さの制限の影響を受ける場合あり
- 更新や削除が難しい（更新すると他のパスも更新が必要になる）

## 参考サイト
- [ツリー構造のデータをRDBで扱う](https://qiita.com/tosh_m/items/d11c47e81508b92426fb)



## 不明点調査
### 隣接リスト
各ノードが親ノードへの参照を持つ手法。

以下ChatGPTに出力してもらったテーブルとデータサンプル。  

```sql
CREATE TABLE Employee (
    EmployeeID INT PRIMARY KEY,
    Name VARCHAR(50),
    ManagerID INT, -- 親ノードへの参照
    FOREIGN KEY (ManagerID) REFERENCES Employee(EmployeeID)
);

-- データの例
INSERT INTO Employee (EmployeeID, Name, ManagerID) VALUES
(1, 'CEO', NULL), -- 最上位のノード
(2, 'Manager A', 1), -- CEOの直下のノード
(3, 'Manager B', 1), -- CEOの直下のノード
(4, 'Employee X', 2), -- Manager Aの直下のノード
(5, 'Employee Y', 2), -- Manager Aの直下のノード
(6, 'Employee Z', 3); -- Manager Bの直下のノード

```
Employeeテーブル  
従業員テーブル。各レコードが従業員データ。ManagerIdが親ノード（上司）への参照を表している。  
最上位の役職は上司がいない（根ノード：最上位ノード）ため、NULLとなっている。  

■メリット  
構造がシンプルで隣接した親子関係のデータ取得が容易。  

■デメリット  
フォルダの階層が深い場合は、その階層分結合が必要になる（階層が浅い場合や深さを制限する場合は、シンプルな構造なので良い）。  
ただし、再帰クエリをサポートしているDBではこのデメリットは解消できる。  
また、削除時に物理削除だと整合性を保つコストが結構かかるため論理削除でデータ上は階層構造を保つということも手ではある。

■参考  
- [隣接リスト（ナイーブツリー）のデータの持ち方](https://zenn.dev/rescuenow/articles/c7d7291f2deed8#%E9%9A%A3%E6%8E%A5%E3%83%AA%E3%82%B9%E3%83%88%EF%BC%88%E3%83%8A%E3%82%A4%E3%83%BC%E3%83%96%E3%83%84%E3%83%AA%E3%83%BC%EF%BC%89%E3%81%AE%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%8C%81%E3%81%A1%E6%96%B9)