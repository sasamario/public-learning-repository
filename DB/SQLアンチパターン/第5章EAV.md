# 第5章エンティティ・アトリビュート・バリュー（EAV） p51~66
## アンチパターンが発生する背景
可変属性を許容する（柔軟性を高める）ために、汎用的な属性テーブルを使用する  

### 汎用的な属性テーブルとは？
いわゆる属性とその属性値をカラムとしてもつテーブル。  

汎用的な属性テーブルは以下のメリットがある。
- 新しい属性値を追加する際に既存テーブルのカラムを増やす必要がない。（汎用的な属性テーブルにレコードを追加すれば良いので）
- テーブルのカラム数（列数）を減らすことができる→属性値用のテーブルで担うため


## アンチパターンによる影響
汎用的な属性テーブルを利用することによる影響は以下の通り
- 必須属性の設定ができない
	- 自身のテーブルカラムに属性値を持つ場合は、NOT NULL製薬で必須扱いにできるが、属性テーブルだと行単位で属性値を持つため、制約による必須設定が難しい。
- DBのデータ型を活用できない
	- 属性テーブルでは様々な属性をレコードでもつことから、文字列型で定義する。そのため、型によって無効データを弾くことができない（できないことはないが、型用のカラムを用意するなど対応が必要になり、結果クエリが複雑化する...）
- 参照整合性を矯正できない
	- 上記同様、様々な属性をレコードで持つため参照整合性の設定ができない（特定の属性のレコードにのみ設定！ということができないため）
- クエリが複雑になる
	- 特定の属性値を取得するために複数の結合が必要になり、複雑化する


## 解決策
サブタイプのモデリングを使う。  

### サブタイプとは
ChatGPTによると以下のように説明が出力された。  

>サブタイプのモデリングは、データベース設計において、1つの親エンティティ（スーパータイプ）が複数の種類のサブエンティティに分類される場合に使用される手法です。これにより、異なる種類のエンティティに特有の属性や動作を持たせることができます。
>
>具体的な例を見てみましょう。考えてみるテーブルが「動物」というスーパータイプを持つ場合、この「動物」テーブルは様々な種類の動物（猫、犬、鳥など）を表現します。各動物の種類には異なる属性があります。例えば、猫には「体重」や「毛の色」のような特有の属性がありますが、犬には「体高」や「しっぽの長さ」などの異なる属性があるかもしれません。
>
>サブタイプのモデリングでは、このような異なる属性を持つサブタイプを表現するために、各サブタイプに対応するテーブルを作成します。つまり、「猫」と「犬」というサブタイプのために、それぞれ別々のテーブルを作成します。そして、これらのテーブルは共通の親テーブルである「動物」テーブルと1対1の関係を持ちます。
>
>このようにすることで、各サブタイプに特有の属性を持たせつつ、共通の属性や動作をスーパータイプとして共有することができます。サブタイプのモデリングは、データベースの柔軟性と拡張性を高め、正規化を促進する効果があります。

上記例で言うと、「動物」テーブルが基底型（スーパータイプ、親タイプ）と呼ばれる。  
規定型はサブタイプの特性を抽象化し、データモデルを効率的に管理するために使用される。

### 本書で紹介されている解決策の設計手法
本書では以下の設計を紹介している。  
- シングルテーブル継承
- 具象テーブル継承
- クラステーブル継承
- 半構造化データ

以下サイトがこのあたりを図をもとにわかりやすく説明しているためおすすめ。
- [【SQLアンチパターン】EAV（エンティティ・アトリビュート・バリュー）について](https://note.com/standenglish/n/n4bdb1d5f2a80)
