## スキーマ設定変更

1. schema.prisma に変更を加える
2. マイグレーションファイル作成、実行　例）`npx prisma migrate dev --name [マイグレーションフォルダ名]`

migrate dev は seed の実行まで一括して行われる。

■ 参考  
[マイグレーション](https://zenn.dev/thirosue/books/49a4ee418743ed/viewer/57d161)

## データ投入

```bash
npx prisma db seed
```

■ 参考  
[Prisma でシードデータを作成](https://zenn.dev/hayato94087/books/e9c2721ff22ac7/viewer/i01qwjendsop5fw#%E3%82%B7%E3%83%BC%E3%83%89%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E4%BD%9C%E6%88%90)

## ローカル環境で DB のリセットが要求される件

チーム開発をしていて、ブランチを切り替えた時場合よってはローカル DB のリセットが要求される。  
今までは都度リセットしていたが、結構時間がかかるので対応策について以下に記載する。

### DB リセットが求められる理由

マイグレーションの履歴と DB の状態が一致しない場合（ドリフトというらしい）、DB のリセットが求められるらしい。

- ★ ブランチを切り替えた時（違うマイグレーション履歴に切り替わるため）
- マイグレーションファイルを手動で変更、削除
- schema.prisma を変更したのに、マイグレーションファイルを作っていない
- DB に直接変更を加えた場合

### リセット時の挙動

- DROP DATABASE 相当の処理
- マイグレーションを最初から適用
- prisma/seed.ts がある場合は自動で seed を再実行

### 対応策

ブランチ切り替えによって生じる差を確認し、手動で DB を調整する。

■ ケース例：ブランチ A でカラムを追加、ブランチ B に切り替えて migrate dev 実行時にリセットが要求された場合  
リセットが要求されるのは、DB 上にはブランチ A で追加したカラムがあるもののブランチ B のマイグレーション履歴上にはないことにより内容が一致しないこと。  
そこで「ブランチ A で追加したカラムを、手動で DB から削除（こうすることで、ブランチ B 上の履歴と同じ状態にする）」ことでズレを解消する。  
もしこれで不都合があれば、その時はローカル DB なので今まで通り初期化で良い。
